#!/bin/sh
#
# pre-commit
#
# This script increments the CFBundleVersion before each commit
#

plist="./AMCoreAudio/Info.plist"

buildnum=$(git log --oneline | wc -l | tr -d '[:space:]')
if [ -z "$buildnum" ]; then
    echo "Failed to set buildNum. Please fix your pre-commit hook."
    exit 1
fi

buildnumplus=$(expr $buildnum + 1)
/usr/libexec/Plistbuddy -c "Set CFBundleVersion $buildnumplus" "$plist"

git add $plist
echo $(date) "- Incremented CFBundleVersion to" $buildnumplus
